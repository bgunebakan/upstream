{% extends 'cruds/base.html' %}
{% load i18n %}
{% load crispy_forms_tags %}
{% load render_table from django_tables2 %}
{% load crud_tags %}
{% load static %}
{% load personnel_tags %}
{% load portunes_tags %}
{% block title %}Access Control{% endblock %}

{% block page_name %}Access Control{% endblock %}
{% block page_description %}Dashboard{% endblock %}

{% block bodyclass %}skin-purple {%if config.hide_sidebar %}sidebar-collapse{%endif%} {% endblock %}

{% block breadcrumbs %}
<ol class="breadcrumb">
    <li><a href="/portunes/"><i class="fa fa-dashboard"></i> Dashboard</a></li>
    <li class="active">User Access</li>
</ol>
{% endblock %}

{% block content %}

<!-- Content Header (Page header) -->
<section class="content-header">
  <h1>
    <a href="/users/detail/{{personnel.nat_id}}/">{{user.first_name}} {{user.last_name}}</a> Permissions
  </h1>
</section>

<!-- Main content -->
<section class="content">
  <div class="row">
    <div class="col-xs-6">
      <div class="box">
        <div class="box-header">
          <h3 class="box-title">Identifiers</h3>
        </div>
        <!-- /.box-header -->
        <div class="box-body">
          <table class="table table-bordered text-center">
          <tbody>
            <ul>
              {% for id in identifier.all %}
            <form action="" method="post" name="form" id="form">
              {% csrf_token %}

              <a href="/portunes/identifier/{{id.id}}/update"><li class="fa fa-user" > {{id.name}} - {{id.key}}</li></a>
              <input type="hidden" name="identifier" id="identifier" value="{{id.id}}" />&nbsp;&nbsp;&nbsp;
              <button type="submit" name="deleteidentifier" value="deleteidentifier" class="btn btn-xs btn-danger">Delete</button>
              <br>


            </form>
            {% endfor %}
          </ul>
        </tbody></table>
        </div>
        <!-- /.box-body -->
      </div>
    </div>
    <div class="col-xs-6">
      <div class="box">
        <div class="box-header">
          <h3 class="box-title">Door Groups</h3>
        </div>
        <!-- /.box-header -->
        <div class="box-body">
          <table class="table table-bordered text-center">
          <tbody>
            <ul>
             {% for door_group in door_groups.all %}
              <a href="?door_group={{door_group.id}}" value="{{door_group.id}}" ><li class="fa fa-archive" > {{door_group.name}}</li></a>

              <br>

              {% endfor %}
          </ul>
        </tbody></table>
        </div>
        <!-- /.box-body -->
      </div>
    </div>
    <div class="col-xs-12">
      <div class="box">
        <div class="box-header">

          <h3 class="box-title">{{table_label}}</h3>

        </div>
        <!-- /.box-header -->
        <div class="box-body">
          <label for="AllCheckbox">All</label>
          <input type="checkbox" ID="AllCheckbox" />
          <label for="NoneCheckbox">None</label>
          <input type="checkbox" ID="NoneCheckbox" />
          {%if request.GET.door_group %}
            {%get_group_doors request.GET.door_group as permissions%}
          {%endif%}

          <form action="" method="post" name="form" id="form">

              {% csrf_token %}
          <table class="table table-bordered text-center">
          <tbody>
            <ul>
          {% for controller in controllers.all %}
            {% cycle '<tr>' '' '' %}
                <td>

            <a href="/controllers/detail/{{controller.mac}}">
              <i class="fa fa-archive"></i> <span>{{ controller.name}}</span>
            </a><br>

             {% for door in doors.all %}

              {%if door.entrance.name == controller.name %}
              <li class="fa fa-code-fork" > {{door.entrance_controller_pin}} - {{door.name}}
                <input type="checkbox" class="checkbox" name="permissions" value="{{door.id}}"
                id="{{door.id}}"
                  {%for permission in permissions %}
                  {%if request.GET.door_group %}
                      {%if permission == door %}
                      checked
                      {%endif%}
                  {%else%}
                    {%if permission.door == door %}
                    checked
                    {%endif%}
                  {%endif%}

                {%endfor%}
                >
              </li><br>
              {%endif%}
              {% endfor %}
                </td>
            {% cycle '' '' '</tr>' %}

          {% endfor %}
          </ul>
        </tbody></table>
          <div class="box-footer">
            <button type="submit" name="savepermission" value="savepermission" class="btn btn-primary">Save</button>
            <button type="submit" name="clearpermission" value="clearpermission" class="btn btn-danger">Delete Permission</button>
          </div>
          </form>
        </div>
        <!-- /.box-body -->
      </div>
      <!-- /.box -->

    </div>
    <!-- /.col -->
  </div>
  <!-- /.row -->
</section>
<!-- /.content -->




{% endblock %}

{% block javascript %}
<script>
$(document).ready(function () {
    $('#AllCheckbox').click(function () {
        $('#NoneCheckbox').prop('checked',false);
        $('.checkbox').prop('checked', "checked");
    });

    $('#NoneCheckbox').click(function () {
        $('#AllCheckbox').prop('checked',false);
        $('.checkbox').prop('checked',false);
    });

    $('#GroupCheckbox').click(function () {
        alert('Type checkbox was clicked');
    });

    $('.checkbox').click(function () {
       // alert('Type checkbox was clicked');
        $('#AllCheckbox').prop('checked',false);
        $('#NoneCheckbox').prop('checked',false);
    });
});
</script>
{% endblock %}
